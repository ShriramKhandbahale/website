---
interface Author {
  name: string
  url?: string
}

interface Props {
  title?: string
  description: string
  date?: string
  authors?: Author[]
  tags?: string[]
  banner?: {
    url?: string
    alt?: string
    width?: number
    height?: number
  }
  siteName?: string
}

const {
  title,
  description,
  date,
  authors = [],
  tags = [],
  banner,
  siteName = 'Shriram Khandbahale',
} = Astro.props as Props

const {
  url: bannerUrl = `${Astro.site}/og.png`,
  alt: bannerAlt = title ?? 'Website preview image',
  width: bannerWidth = 1200,
  height: bannerHeight = 630,
} = banner || {}

const canonicalURL = new URL(Astro.url.pathname, Astro.site)
const isArticle = Boolean(date)
const fullTitle = title ? `${title} | ${siteName}` : siteName

const articleSchema = isArticle
  ? {
      '@context': 'https://schema.org',
      '@type': 'Article',
      headline: title,
      description,
      image: [
        {
          contentUrl: bannerUrl,
          width: bannerWidth,
          height: bannerHeight,
          caption: bannerAlt,
        },
      ],
      datePublished: date,
      author: authors.map((a) => ({
        '@type': 'Person',
        name: a.name,
        url: a.url,
      })),
      mainEntityOfPage: canonicalURL.href,
      keywords: tags.join(', '),
    }
  : null
---

<title>{fullTitle}</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="description" content={description} />
<meta name="keywords" content={tags.join(', ')} />

<meta property="og:title" content={title ?? siteName} />
<meta property="og:site_name" content={siteName} />
<meta property="og:description" content={description} />
<meta property="og:url" content={canonicalURL.href} />
<meta property="og:type" content={isArticle ? 'article' : 'website'} />
<meta property="og:locale" content="en_US" />

<link rel="canonical" href={canonicalURL.href} />

<meta property="og:image" content={bannerUrl} />
<meta property="og:image:alt" content={bannerAlt} />
<meta property="og:image:width" content={bannerWidth.toString()} />
<meta property="og:image:height" content={bannerHeight.toString()} />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />

<meta name="theme-color" content="#f5f5f5" />
<link rel="icon" href="/favicon.svg" />

<link rel="sitemap" href="/sitemap-index.xml" />

{isArticle && date ? (
  <meta property="article:published_time" content={date} />
) : null}

{authors.map((author) => (
  <meta property="article:author" content={author.name} />
))}

{articleSchema ? (
  <script type="application/ld+json">
    {JSON.stringify(articleSchema)}
  </script>
) : null}
